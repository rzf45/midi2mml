const te=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&a(n)}).observe(document,{childList:!0,subtree:!0});function r(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(i){if(i.ep)return;i.ep=!0;const o=r(i);fetch(i.href,o)}};te();var O=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function re(e){var t=e.default;if(typeof t=="function"){var r=function(){return t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(a){var i=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(r,a,i.get?i:{enumerable:!0,get:function(){return e[a]}})}),r}var R={},j={};function ne(e){var t=new I(e),r=t.readChunk();if(r.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+r.id+"'";for(var a=ie(r.data),i=[],o=0;!t.eof()&&o<a.numTracks;o++){var n=t.readChunk();if(n.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+n.id+"'";var f=ae(n.data);i.push(f)}return{header:a,tracks:i}}function ie(e){var t=new I(e),r=t.readUInt16(),a=t.readUInt16(),i={format:r,numTracks:a},o=t.readUInt16();return o&32768?(i.framesPerSecond=256-(o>>8),i.ticksPerFrame=o&255):i.ticksPerBeat=o,i}function ae(e){for(var t=new I(e),r=[];!t.eof();){var a=o();r.push(a)}return r;var i;function o(){var n={};n.deltaTime=t.readVarInt();var f=t.readUInt8();if((f&240)===240)if(f===255){n.meta=!0;var u=t.readUInt8(),c=t.readVarInt();switch(u){case 0:if(n.type="sequenceNumber",c!==2)throw"Expected length for sequenceNumber event is 2, got "+c;return n.number=t.readUInt16(),n;case 1:return n.type="text",n.text=t.readString(c),n;case 2:return n.type="copyrightNotice",n.text=t.readString(c),n;case 3:return n.type="trackName",n.text=t.readString(c),n;case 4:return n.type="instrumentName",n.text=t.readString(c),n;case 5:return n.type="lyrics",n.text=t.readString(c),n;case 6:return n.type="marker",n.text=t.readString(c),n;case 7:return n.type="cuePoint",n.text=t.readString(c),n;case 32:if(n.type="channelPrefix",c!=1)throw"Expected length for channelPrefix event is 1, got "+c;return n.channel=t.readUInt8(),n;case 33:if(n.type="portPrefix",c!=1)throw"Expected length for portPrefix event is 1, got "+c;return n.port=t.readUInt8(),n;case 47:if(n.type="endOfTrack",c!=0)throw"Expected length for endOfTrack event is 0, got "+c;return n;case 81:if(n.type="setTempo",c!=3)throw"Expected length for setTempo event is 3, got "+c;return n.microsecondsPerBeat=t.readUInt24(),n;case 84:if(n.type="smpteOffset",c!=5)throw"Expected length for smpteOffset event is 5, got "+c;var b=t.readUInt8(),p={0:24,32:25,64:29,96:30};return n.frameRate=p[b&96],n.hour=b&31,n.min=t.readUInt8(),n.sec=t.readUInt8(),n.frame=t.readUInt8(),n.subFrame=t.readUInt8(),n;case 88:if(n.type="timeSignature",c!=2&&c!=4)throw"Expected length for timeSignature event is 4 or 2, got "+c;return n.numerator=t.readUInt8(),n.denominator=1<<t.readUInt8(),c===4?(n.metronome=t.readUInt8(),n.thirtyseconds=t.readUInt8()):(n.metronome=36,n.thirtyseconds=8),n;case 89:if(n.type="keySignature",c!=2)throw"Expected length for keySignature event is 2, got "+c;return n.key=t.readInt8(),n.scale=t.readUInt8(),n;case 127:return n.type="sequencerSpecific",n.data=t.readBytes(c),n;default:return n.type="unknownMeta",n.data=t.readBytes(c),n.metatypeByte=u,n}}else if(f==240){n.type="sysEx";var c=t.readVarInt();return n.data=t.readBytes(c),n}else if(f==247){n.type="endSysEx";var c=t.readVarInt();return n.data=t.readBytes(c),n}else throw"Unrecognised MIDI event type byte: "+f;else{var s;if((f&128)===0){if(i===null)throw"Running status byte encountered before status byte";s=f,f=i,n.running=!0}else s=t.readUInt8(),i=f;var l=f>>4;switch(n.channel=f&15,l){case 8:return n.type="noteOff",n.noteNumber=s,n.velocity=t.readUInt8(),n;case 9:var m=t.readUInt8();return n.type=m===0?"noteOff":"noteOn",n.noteNumber=s,n.velocity=m,m===0&&(n.byte9=!0),n;case 10:return n.type="noteAftertouch",n.noteNumber=s,n.amount=t.readUInt8(),n;case 11:return n.type="controller",n.controllerType=s,n.value=t.readUInt8(),n;case 12:return n.type="programChange",n.programNumber=s,n;case 13:return n.type="channelAftertouch",n.amount=s,n;case 14:return n.type="pitchBend",n.value=s+(t.readUInt8()<<7)-8192,n;default:throw"Unrecognised MIDI event type: "+l}}}}function I(e){this.buffer=e,this.bufferLen=this.buffer.length,this.pos=0}I.prototype.eof=function(){return this.pos>=this.bufferLen};I.prototype.readUInt8=function(){var e=this.buffer[this.pos];return this.pos+=1,e};I.prototype.readInt8=function(){var e=this.readUInt8();return e&128?e-256:e};I.prototype.readUInt16=function(){var e=this.readUInt8(),t=this.readUInt8();return(e<<8)+t};I.prototype.readInt16=function(){var e=this.readUInt16();return e&32768?e-65536:e};I.prototype.readUInt24=function(){var e=this.readUInt8(),t=this.readUInt8(),r=this.readUInt8();return(e<<16)+(t<<8)+r};I.prototype.readInt24=function(){var e=this.readUInt24();return e&8388608?e-16777216:e};I.prototype.readUInt32=function(){var e=this.readUInt8(),t=this.readUInt8(),r=this.readUInt8(),a=this.readUInt8();return(e<<24)+(t<<16)+(r<<8)+a};I.prototype.readBytes=function(e){var t=this.buffer.slice(this.pos,this.pos+e);return this.pos+=e,t};I.prototype.readString=function(e){var t=this.readBytes(e);return String.fromCharCode.apply(null,t)};I.prototype.readVarInt=function(){for(var e=0;!this.eof();){var t=this.readUInt8();if(t&128)e+=t&127,e<<=7;else return e+t}return e};I.prototype.readChunk=function(){var e=this.readString(4),t=this.readUInt32(),r=this.readBytes(t);return{id:e,length:t,data:r}};var oe=ne;function se(e,t){if(typeof e!="object")throw"Invalid MIDI data";t=t||{};var r=e.header||{},a=e.tracks||[],i,o=a.length,n=new g;for(ce(n,r,o),i=0;i<o;i++)ue(n,a[i],t);return n.buffer}function ce(e,t,r){var a=t.format==null?1:t.format,i=128;t.timeDivision?i=t.timeDivision:t.ticksPerFrame&&t.framesPerSecond?i=-(t.framesPerSecond&255)<<8|t.ticksPerFrame&255:t.ticksPerBeat&&(i=t.ticksPerBeat&32767);var o=new g;o.writeUInt16(a),o.writeUInt16(r),o.writeUInt16(i),e.writeChunk("MThd",o.buffer)}function ue(e,t,r){var a=new g,i,o=t.length,n=null;for(i=0;i<o;i++)(r.running===!1||!r.running&&!t[i].running)&&(n=null),n=fe(a,t[i],n,r.useByte9ForNoteOff);e.writeChunk("MTrk",a.buffer)}function fe(e,t,r,a){var i=t.type,o=t.deltaTime,n=t.text||"",f=t.data||[],u=null;switch(e.writeVarInt(o),i){case"sequenceNumber":e.writeUInt8(255),e.writeUInt8(0),e.writeVarInt(2),e.writeUInt16(t.number);break;case"text":e.writeUInt8(255),e.writeUInt8(1),e.writeVarInt(n.length),e.writeString(n);break;case"copyrightNotice":e.writeUInt8(255),e.writeUInt8(2),e.writeVarInt(n.length),e.writeString(n);break;case"trackName":e.writeUInt8(255),e.writeUInt8(3),e.writeVarInt(n.length),e.writeString(n);break;case"instrumentName":e.writeUInt8(255),e.writeUInt8(4),e.writeVarInt(n.length),e.writeString(n);break;case"lyrics":e.writeUInt8(255),e.writeUInt8(5),e.writeVarInt(n.length),e.writeString(n);break;case"marker":e.writeUInt8(255),e.writeUInt8(6),e.writeVarInt(n.length),e.writeString(n);break;case"cuePoint":e.writeUInt8(255),e.writeUInt8(7),e.writeVarInt(n.length),e.writeString(n);break;case"channelPrefix":e.writeUInt8(255),e.writeUInt8(32),e.writeVarInt(1),e.writeUInt8(t.channel);break;case"portPrefix":e.writeUInt8(255),e.writeUInt8(33),e.writeVarInt(1),e.writeUInt8(t.port);break;case"endOfTrack":e.writeUInt8(255),e.writeUInt8(47),e.writeVarInt(0);break;case"setTempo":e.writeUInt8(255),e.writeUInt8(81),e.writeVarInt(3),e.writeUInt24(t.microsecondsPerBeat);break;case"smpteOffset":e.writeUInt8(255),e.writeUInt8(84),e.writeVarInt(5);var c={24:0,25:32,29:64,30:96},b=t.hour&31|c[t.frameRate];e.writeUInt8(b),e.writeUInt8(t.min),e.writeUInt8(t.sec),e.writeUInt8(t.frame),e.writeUInt8(t.subFrame);break;case"timeSignature":e.writeUInt8(255),e.writeUInt8(88),e.writeVarInt(4),e.writeUInt8(t.numerator);var p=Math.floor(Math.log(t.denominator)/Math.LN2)&255;e.writeUInt8(p),e.writeUInt8(t.metronome),e.writeUInt8(t.thirtyseconds||8);break;case"keySignature":e.writeUInt8(255),e.writeUInt8(89),e.writeVarInt(2),e.writeInt8(t.key),e.writeUInt8(t.scale);break;case"sequencerSpecific":e.writeUInt8(255),e.writeUInt8(127),e.writeVarInt(f.length),e.writeBytes(f);break;case"unknownMeta":t.metatypeByte!=null&&(e.writeUInt8(255),e.writeUInt8(t.metatypeByte),e.writeVarInt(f.length),e.writeBytes(f));break;case"sysEx":e.writeUInt8(240),e.writeVarInt(f.length),e.writeBytes(f);break;case"endSysEx":e.writeUInt8(247),e.writeVarInt(f.length),e.writeBytes(f);break;case"noteOff":var s=a!==!1&&t.byte9||a&&t.velocity==0?144:128;u=s|t.channel,u!==r&&e.writeUInt8(u),e.writeUInt8(t.noteNumber),e.writeUInt8(t.velocity);break;case"noteOn":u=144|t.channel,u!==r&&e.writeUInt8(u),e.writeUInt8(t.noteNumber),e.writeUInt8(t.velocity);break;case"noteAftertouch":u=160|t.channel,u!==r&&e.writeUInt8(u),e.writeUInt8(t.noteNumber),e.writeUInt8(t.amount);break;case"controller":u=176|t.channel,u!==r&&e.writeUInt8(u),e.writeUInt8(t.controllerType),e.writeUInt8(t.value);break;case"programChange":u=192|t.channel,u!==r&&e.writeUInt8(u),e.writeUInt8(t.programNumber);break;case"channelAftertouch":u=208|t.channel,u!==r&&e.writeUInt8(u),e.writeUInt8(t.amount);break;case"pitchBend":u=224|t.channel,u!==r&&e.writeUInt8(u);var l=8192+t.value,m=l&127,y=l>>7&127;e.writeUInt8(m),e.writeUInt8(y);break;default:throw"Unrecognized event type: "+i}return u}function g(){this.buffer=[]}g.prototype.writeUInt8=function(e){this.buffer.push(e&255)};g.prototype.writeInt8=g.prototype.writeUInt8;g.prototype.writeUInt16=function(e){var t=e>>8&255,r=e&255;this.writeUInt8(t),this.writeUInt8(r)};g.prototype.writeInt16=g.prototype.writeUInt16;g.prototype.writeUInt24=function(e){var t=e>>16&255,r=e>>8&255,a=e&255;this.writeUInt8(t),this.writeUInt8(r),this.writeUInt8(a)};g.prototype.writeInt24=g.prototype.writeUInt24;g.prototype.writeUInt32=function(e){var t=e>>24&255,r=e>>16&255,a=e>>8&255,i=e&255;this.writeUInt8(t),this.writeUInt8(r),this.writeUInt8(a),this.writeUInt8(i)};g.prototype.writeInt32=g.prototype.writeUInt32;g.prototype.writeBytes=function(e){this.buffer=this.buffer.concat(Array.prototype.slice.call(e,0))};g.prototype.writeString=function(e){var t,r=e.length,a=[];for(t=0;t<r;t++)a.push(e.codePointAt(t));this.writeBytes(a)};g.prototype.writeVarInt=function(e){if(e<0)throw"Cannot write negative variable-length integer";if(e<=127)this.writeUInt8(e);else{var t=e,r=[];for(r.push(t&127),t>>=7;t;){var a=t&127|128;r.push(a),t>>=7}this.writeBytes(r.reverse())}};g.prototype.writeChunk=function(e,t){this.writeString(e),this.writeUInt32(t.length),this.writeBytes(t)};var le=se;j.parseMidi=oe;j.writeMidi=le;var _={},C={};Object.defineProperty(C,"__esModule",{value:!0});C.insert=C.search=void 0;function K(e,t,r){r===void 0&&(r="ticks");var a=0,i=e.length,o=i;if(i>0&&e[i-1][r]<=t)return i-1;for(;a<o;){var n=Math.floor(a+(o-a)/2),f=e[n],u=e[n+1];if(f[r]===t){for(var c=n;c<e.length;c++){var b=e[c];b[r]===t&&(n=c)}return n}else{if(f[r]<t&&u[r]>t)return n;f[r]>t?o=n:f[r]<t&&(a=n+1)}}return-1}C.search=K;function he(e,t,r){if(r===void 0&&(r="ticks"),e.length){var a=K(e,t[r],r);e.splice(a+1,0,t)}else e.push(t)}C.insert=he;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Header=e.keySignatureKeys=void 0;var t=C,r=new WeakMap;e.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var a=function(){function i(o){var n=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",r.set(this,480),o){r.set(this,o.header.ticksPerBeat),o.tracks.forEach(function(u){u.forEach(function(c){c.meta&&(c.type==="timeSignature"?n.timeSignatures.push({ticks:c.absoluteTime,timeSignature:[c.numerator,c.denominator]}):c.type==="setTempo"?n.tempos.push({bpm:6e7/c.microsecondsPerBeat,ticks:c.absoluteTime}):c.type==="keySignature"&&n.keySignatures.push({key:e.keySignatureKeys[c.key+7],scale:c.scale===0?"major":"minor",ticks:c.absoluteTime}))})});var f=0;o.tracks[0].forEach(function(u){f+=u.deltaTime,u.meta&&(u.type==="trackName"?n.name=u.text:(u.type==="text"||u.type==="cuePoint"||u.type==="marker"||u.type==="lyrics")&&n.meta.push({text:u.text,ticks:f,type:u.type}))}),this.update()}}return i.prototype.update=function(){var o=this,n=0,f=0;this.tempos.sort(function(u,c){return u.ticks-c.ticks}),this.tempos.forEach(function(u,c){var b=c>0?o.tempos[c-1].bpm:o.tempos[0].bpm,p=u.ticks/o.ppq-f,s=60/b*p;u.time=s+n,n=u.time,f+=p}),this.timeSignatures.sort(function(u,c){return u.ticks-c.ticks}),this.timeSignatures.forEach(function(u,c){var b=c>0?o.timeSignatures[c-1]:o.timeSignatures[0],p=(u.ticks-b.ticks)/o.ppq,s=p/b.timeSignature[0]/(b.timeSignature[1]/4);b.measures=b.measures||0,u.measures=s+b.measures})},i.prototype.ticksToSeconds=function(o){var n=(0,t.search)(this.tempos,o);if(n!==-1){var f=this.tempos[n],u=f.time,c=(o-f.ticks)/this.ppq;return u+60/f.bpm*c}else{var b=o/this.ppq;return 60/120*b}},i.prototype.ticksToMeasures=function(o){var n=(0,t.search)(this.timeSignatures,o);if(n!==-1){var f=this.timeSignatures[n],u=(o-f.ticks)/this.ppq;return f.measures+u/(f.timeSignature[0]/f.timeSignature[1])/4}else return o/this.ppq/4},Object.defineProperty(i.prototype,"ppq",{get:function(){return r.get(this)},enumerable:!1,configurable:!0}),i.prototype.secondsToTicks=function(o){var n=(0,t.search)(this.tempos,o,"time");if(n!==-1){var f=this.tempos[n],u=f.time,c=o-u,b=c/(60/f.bpm);return Math.round(f.ticks+b*this.ppq)}else{var p=o/.5;return Math.round(p*this.ppq)}},i.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(o){return{bpm:o.bpm,ticks:o.ticks}}),timeSignatures:this.timeSignatures}},i.prototype.fromJSON=function(o){this.name=o.name,this.tempos=o.tempos.map(function(n){return Object.assign({},n)}),this.timeSignatures=o.timeSignatures.map(function(n){return Object.assign({},n)}),this.keySignatures=o.keySignatures.map(function(n){return Object.assign({},n)}),this.meta=o.meta.map(function(n){return Object.assign({},n)}),r.set(this,o.ppq),this.update()},i.prototype.setTempo=function(o){this.tempos=[{bpm:o,ticks:0}],this.update()},i}();e.Header=a})(_);var N={},$={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ControlChange=e.controlChangeIds=e.controlChangeNames=void 0,e.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},e.controlChangeIds=Object.keys(e.controlChangeNames).reduce(function(i,o){return i[e.controlChangeNames[o]]=o,i},{});var t=new WeakMap,r=new WeakMap,a=function(){function i(o,n){t.set(this,n),r.set(this,o.controllerType),this.ticks=o.absoluteTime,this.value=o.value}return Object.defineProperty(i.prototype,"number",{get:function(){return r.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return e.controlChangeNames[this.number]?e.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"time",{get:function(){var o=t.get(this);return o.ticksToSeconds(this.ticks)},set:function(o){var n=t.get(this);this.ticks=n.secondsToTicks(o)},enumerable:!1,configurable:!0}),i.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},i}();e.ControlChange=a})($);var E={};Object.defineProperty(E,"__esModule",{value:!0});E.createControlChanges=void 0;var P=$;function de(){return new Proxy({},{get:function(e,t){if(e[t])return e[t];if(P.controlChangeIds.hasOwnProperty(t))return e[P.controlChangeIds[t]]},set:function(e,t,r){return P.controlChangeIds.hasOwnProperty(t)?e[P.controlChangeIds[t]]=r:e[t]=r,!0}})}E.createControlChanges=de;var q={};Object.defineProperty(q,"__esModule",{value:!0});q.PitchBend=void 0;var H=new WeakMap,pe=function(){function e(t,r){H.set(this,r),this.ticks=t.absoluteTime,this.value=t.value}return Object.defineProperty(e.prototype,"time",{get:function(){var t=H.get(this);return t.ticksToSeconds(this.ticks)},set:function(t){var r=H.get(this);this.ticks=r.secondsToTicks(t)},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},e}();q.PitchBend=pe;var V={},U={};Object.defineProperty(U,"__esModule",{value:!0});U.DrumKitByPatchID=U.InstrumentFamilyByID=U.instrumentByPatchID=void 0;U.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"];U.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"];U.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"};Object.defineProperty(V,"__esModule",{value:!0});V.Instrument=void 0;var M=U,W=new WeakMap,me=function(){function e(t,r){if(this.number=0,W.set(this,r),this.number=0,t){var a=t.find(function(i){return i.type==="programChange"});a&&(this.number=a.programNumber)}}return Object.defineProperty(e.prototype,"name",{get:function(){return this.percussion?M.DrumKitByPatchID[this.number]:M.instrumentByPatchID[this.number]},set:function(t){var r=M.instrumentByPatchID.indexOf(t);r!==-1&&(this.number=r)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"family",{get:function(){return this.percussion?"drums":M.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"percussion",{get:function(){var t=W.get(this);return t.channel===9},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},e.prototype.fromJSON=function(t){this.number=t.number},e}();V.Instrument=me;var D={};Object.defineProperty(D,"__esModule",{value:!0});D.Note=void 0;function be(e){var t=Math.floor(e/12)-1;return X(e)+t.toString()}function X(e){var t=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],r=e%12;return t[r]}function ye(e){var t=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return t.indexOf(e)}var ge=function(){var e=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,t={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(r){var a=e.exec(r),i=a[1],o=a[2],n=t[i.toLowerCase()];return n+(parseInt(o,10)+1)*12}}(),S=new WeakMap,ve=function(){function e(t,r,a){S.set(this,a),this.midi=t.midi,this.velocity=t.velocity,this.noteOffVelocity=r.velocity,this.ticks=t.ticks,this.durationTicks=r.ticks-t.ticks}return Object.defineProperty(e.prototype,"name",{get:function(){return be(this.midi)},set:function(t){this.midi=ge(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(t){var r=t-this.octave;this.midi+=r*12},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pitch",{get:function(){return X(this.midi)},set:function(t){this.midi=12*(this.octave+1)+ye(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){var t=S.get(this);return t.ticksToSeconds(this.ticks+this.durationTicks)-t.ticksToSeconds(this.ticks)},set:function(t){var r=S.get(this),a=r.secondsToTicks(this.time+t);this.durationTicks=a-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"time",{get:function(){var t=S.get(this);return t.ticksToSeconds(this.ticks)},set:function(t){var r=S.get(this);this.ticks=r.secondsToTicks(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bars",{get:function(){var t=S.get(this);return t.ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},e}();D.Note=ve;Object.defineProperty(N,"__esModule",{value:!0});N.Track=void 0;var L=C,ke=$,Ie=E,xe=q,z=V,Te=D,B=new WeakMap,we=function(){function e(t,r){var a=this;if(this.name="",this.notes=[],this.controlChanges=(0,Ie.createControlChanges)(),this.pitchBends=[],B.set(this,r),t){var i=t.find(function(s){return s.type==="trackName"});this.name=i?i.text:""}if(this.instrument=new z.Instrument(t,this),this.channel=0,t){for(var o=t.filter(function(s){return s.type==="noteOn"}),n=t.filter(function(s){return s.type==="noteOff"}),f=function(){var s=o.shift();u.channel=s.channel;var l=n.findIndex(function(y){return y.noteNumber===s.noteNumber&&y.absoluteTime>=s.absoluteTime});if(l!==-1){var m=n.splice(l,1)[0];u.addNote({durationTicks:m.absoluteTime-s.absoluteTime,midi:s.noteNumber,noteOffVelocity:m.velocity/127,ticks:s.absoluteTime,velocity:s.velocity/127})}},u=this;o.length;)f();var c=t.filter(function(s){return s.type==="controller"});c.forEach(function(s){a.addCC({number:s.controllerType,ticks:s.absoluteTime,value:s.value/127})});var b=t.filter(function(s){return s.type==="pitchBend"});b.forEach(function(s){a.addPitchBend({ticks:s.absoluteTime,value:s.value/Math.pow(2,13)})});var p=t.find(function(s){return s.type==="endOfTrack"});this.endOfTrackTicks=p!==void 0?p.absoluteTime:void 0}}return e.prototype.addNote=function(t){var r=B.get(this),a=new Te.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},r);return Object.assign(a,t),(0,L.insert)(this.notes,a,"ticks"),this},e.prototype.addCC=function(t){var r=B.get(this),a=new ke.ControlChange({controllerType:t.number},r);return delete t.number,Object.assign(a,t),Array.isArray(this.controlChanges[a.number])||(this.controlChanges[a.number]=[]),(0,L.insert)(this.controlChanges[a.number],a,"ticks"),this},e.prototype.addPitchBend=function(t){var r=B.get(this),a=new xe.PitchBend({},r);return Object.assign(a,t),(0,L.insert)(this.pitchBends,a,"ticks"),this},Object.defineProperty(e.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var t=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,r=0;r<this.notes.length-1;r++){var a=this.notes[r].time+this.notes[r].duration;t<a&&(t=a)}return t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var t=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,r=0;r<this.notes.length-1;r++){var a=this.notes[r].ticks+this.notes[r].durationTicks;t<a&&(t=a)}return t},enumerable:!1,configurable:!0}),e.prototype.fromJSON=function(t){var r=this;this.name=t.name,this.channel=t.channel,this.instrument=new z.Instrument(void 0,this),this.instrument.fromJSON(t.instrument),t.endOfTrackTicks!==void 0&&(this.endOfTrackTicks=t.endOfTrackTicks);for(var a in t.controlChanges)t.controlChanges[a]&&t.controlChanges[a].forEach(function(i){r.addCC({number:i.number,ticks:i.ticks,value:i.value})});t.notes.forEach(function(i){r.addNote({durationTicks:i.durationTicks,midi:i.midi,ticks:i.ticks,velocity:i.velocity})})},e.prototype.toJSON=function(){for(var t={},r=0;r<127;r++)this.controlChanges.hasOwnProperty(r)&&(t[r]=this.controlChanges[r].map(function(i){return i.toJSON()}));var a={channel:this.channel,controlChanges:t,pitchBends:this.pitchBends.map(function(i){return i.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(i){return i.toJSON()})};return this.endOfTrackTicks!==void 0&&(a.endOfTrackTicks=this.endOfTrackTicks),a},e}();N.Track=we;var A={};function Ue(e){var t=[];return Q(e,t),t}function Q(e,t){for(var r=0;r<e.length;r++){var a=e[r];Array.isArray(a)?Q(a,t):t.push(a)}}const Ce=Object.freeze(Object.defineProperty({__proto__:null,flatten:Ue},Symbol.toStringTag,{value:"Module"})),Se=re(Ce);var w=O&&O.__spreadArray||function(e,t,r){if(r||arguments.length===2)for(var a=0,i=t.length,o;a<i;a++)(o||!(a in t))&&(o||(o=Array.prototype.slice.call(t,0,a)),o[a]=t[a]);return e.concat(o||Array.prototype.slice.call(t))};Object.defineProperty(A,"__esModule",{value:!0});A.encode=void 0;var Oe=j,Fe=_,Ne=Se;function Pe(e,t){return[{absoluteTime:e.ticks,channel:t,deltaTime:0,noteNumber:e.midi,type:"noteOn",velocity:Math.floor(e.velocity*127)},{absoluteTime:e.ticks+e.durationTicks,channel:t,deltaTime:0,noteNumber:e.midi,type:"noteOff",velocity:Math.floor(e.noteOffVelocity*127)}]}function Me(e){return(0,Ne.flatten)(e.notes.map(function(t){return Pe(t,e.channel)}))}function Be(e,t){return{absoluteTime:e.ticks,channel:t,controllerType:e.number,deltaTime:0,type:"controller",value:Math.floor(e.value*127)}}function _e(e){for(var t=[],r=0;r<127;r++)e.controlChanges.hasOwnProperty(r)&&e.controlChanges[r].forEach(function(a){t.push(Be(a,e.channel))});return t}function je(e,t){return{absoluteTime:e.ticks,channel:t,deltaTime:0,type:"pitchBend",value:e.value}}function Ee(e){var t=[];return e.pitchBends.forEach(function(r){t.push(je(r,e.channel))}),t}function qe(e){return{absoluteTime:0,channel:e.channel,deltaTime:0,programNumber:e.instrument.number,type:"programChange"}}function Ve(e){return{absoluteTime:0,deltaTime:0,meta:!0,text:e,type:"trackName"}}function De(e){return{absoluteTime:e.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/e.bpm),type:"setTempo"}}function Ae(e){return{absoluteTime:e.ticks,deltaTime:0,denominator:e.timeSignature[1],meta:!0,metronome:24,numerator:e.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}function Je(e){var t=Fe.keySignatureKeys.indexOf(e.key);return{absoluteTime:e.ticks,deltaTime:0,key:t+7,meta:!0,scale:e.scale==="major"?0:1,type:"keySignature"}}function He(e){return{absoluteTime:e.ticks,deltaTime:0,meta:!0,text:e.text,type:e.type}}function Le(e){var t={header:{format:1,numTracks:e.tracks.length+1,ticksPerBeat:e.header.ppq},tracks:w([w(w(w(w([{absoluteTime:0,deltaTime:0,meta:!0,text:e.header.name,type:"trackName"}],e.header.keySignatures.map(function(r){return Je(r)}),!0),e.header.meta.map(function(r){return He(r)}),!0),e.header.tempos.map(function(r){return De(r)}),!0),e.header.timeSignatures.map(function(r){return Ae(r)}),!0)],e.tracks.map(function(r){return w(w(w([Ve(r.name),qe(r)],Me(r),!0),_e(r),!0),Ee(r),!0)}),!0)};return t.tracks=t.tracks.map(function(r){r=r.sort(function(i,o){return i.absoluteTime-o.absoluteTime});var a=0;return r.forEach(function(i){i.deltaTime=i.absoluteTime-a,a=i.absoluteTime,delete i.absoluteTime}),r.push({deltaTime:0,meta:!0,type:"endOfTrack"}),r}),new Uint8Array((0,Oe.writeMidi)(t))}A.encode=Le;(function(e){var t=O&&O.__awaiter||function(p,s,l,m){function y(h){return h instanceof l?h:new l(function(k){k(h)})}return new(l||(l=Promise))(function(h,k){function x(v){try{d(m.next(v))}catch(F){k(F)}}function T(v){try{d(m.throw(v))}catch(F){k(F)}}function d(v){v.done?h(v.value):y(v.value).then(x,T)}d((m=m.apply(p,s||[])).next())})},r=O&&O.__generator||function(p,s){var l={label:0,sent:function(){if(h[0]&1)throw h[1];return h[1]},trys:[],ops:[]},m,y,h,k;return k={next:x(0),throw:x(1),return:x(2)},typeof Symbol=="function"&&(k[Symbol.iterator]=function(){return this}),k;function x(d){return function(v){return T([d,v])}}function T(d){if(m)throw new TypeError("Generator is already executing.");for(;l;)try{if(m=1,y&&(h=d[0]&2?y.return:d[0]?y.throw||((h=y.return)&&h.call(y),0):y.next)&&!(h=h.call(y,d[1])).done)return h;switch(y=0,h&&(d=[d[0]&2,h.value]),d[0]){case 0:case 1:h=d;break;case 4:return l.label++,{value:d[1],done:!1};case 5:l.label++,y=d[1],d=[0];continue;case 7:d=l.ops.pop(),l.trys.pop();continue;default:if(h=l.trys,!(h=h.length>0&&h[h.length-1])&&(d[0]===6||d[0]===2)){l=0;continue}if(d[0]===3&&(!h||d[1]>h[0]&&d[1]<h[3])){l.label=d[1];break}if(d[0]===6&&l.label<h[1]){l.label=h[1],h=d;break}if(h&&l.label<h[2]){l.label=h[2],l.ops.push(d);break}h[2]&&l.ops.pop(),l.trys.pop();continue}d=s.call(p,l)}catch(v){d=[6,v],y=0}finally{m=h=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}};Object.defineProperty(e,"__esModule",{value:!0}),e.Header=e.Track=e.Midi=void 0;var a=j,i=_,o=N,n=A,f=function(){function p(s){var l=this,m=null;if(s){var y=s instanceof ArrayBuffer?new Uint8Array(s):s;m=(0,a.parseMidi)(y),m.tracks.forEach(function(h){var k=0;h.forEach(function(x){k+=x.deltaTime,x.absoluteTime=k})}),m.tracks=b(m.tracks)}this.header=new i.Header(m),this.tracks=[],s&&(this.tracks=m.tracks.map(function(h){return new o.Track(h,l.header)}),m.header.format===1&&this.tracks[0].duration===0&&this.tracks.shift())}return p.fromUrl=function(s){return t(this,void 0,void 0,function(){var l,m;return r(this,function(y){switch(y.label){case 0:return[4,fetch(s)];case 1:return l=y.sent(),l.ok?[4,l.arrayBuffer()]:[3,3];case 2:return m=y.sent(),[2,new p(m)];case 3:throw new Error("Could not load '".concat(s,"'"))}})})},Object.defineProperty(p.prototype,"name",{get:function(){return this.header.name},set:function(s){this.header.name=s},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"duration",{get:function(){var s=this.tracks.map(function(l){return l.duration});return Math.max.apply(Math,s)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"durationTicks",{get:function(){var s=this.tracks.map(function(l){return l.durationTicks});return Math.max.apply(Math,s)},enumerable:!1,configurable:!0}),p.prototype.addTrack=function(){var s=new o.Track(void 0,this.header);return this.tracks.push(s),s},p.prototype.toArray=function(){return(0,n.encode)(this)},p.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(s){return s.toJSON()})}},p.prototype.fromJSON=function(s){var l=this;this.header=new i.Header,this.header.fromJSON(s.header),this.tracks=s.tracks.map(function(m){var y=new o.Track(void 0,l.header);return y.fromJSON(m),y})},p.prototype.clone=function(){var s=new p;return s.fromJSON(this.toJSON()),s},p}();e.Midi=f;var u=N;Object.defineProperty(e,"Track",{enumerable:!0,get:function(){return u.Track}});var c=_;Object.defineProperty(e,"Header",{enumerable:!0,get:function(){return c.Header}});function b(p){for(var s=[],l=0;l<p.length;l++)for(var m=s.length,y=new Map,h=Array(16).fill(0),k=0,x=p[l];k<x.length;k++){var T=x[k],d=m,v=T.channel;if(v!==void 0){T.type==="programChange"&&(h[v]=T.programNumber);var F=h[v],J="".concat(F," ").concat(v);y.has(J)?d=y.get(J):(d=m+y.size,y.set(J,d))}s[d]||s.push([]),s[d].push(T)}return s}})(R);function $e(e,t,r){let a=r;for(let i=0;i<t.length;i++)if(e===t[i][0]){a=t[i][1];break}return a}function Ge(e){const t=Re(Xe(Qe(ee(e.notes),"desc"))),r=[];for(const a of t){if(a.length==0)break;let i=0,o=0,n="";a.forEach(f=>{const u=f.durationTicks,c=f.ticks,b=f.octave-1;for(Y(i,f)&&(n+=Z(c-i),i+=c-i);b!=o;)b>o?(n+=">",o++):b<o&&(n+="<",o--);n+=`${Ke(f.name)}${G(u)}`,i+=f.durationTicks}),r.push(n.trim())}return r}function We(e){const t=Object.entries(ee(e.notes));let r=0,a="";for(const[i,o]of t){let n=0;Y(r,o[0])&&(a+=Z(parseInt(i)-r),r+=parseInt(i)-r),o.forEach(f=>{n+=ze(f)}),a+=`@${n}c${G(o[0].durationTicks)}`,r+=o[0].durationTicks}return a.trim()}function Y(e,t){return t.ticks>e}function Z(e){return`r${G(e)}`}function ze(e){return $e(e.name,[["C2",1],["E2",2],["F2",4],["A2",8],["C3",16],["XX",32],["D2",64],["F#2",128],["A#2",256],["C#3",512],["D#3",1024]],0)}function G(e){let t=e,r="";for(;t>0;)t>=512?(t=t-512,r+="1&"):t>=256?(t=t-256,r+="2&"):t>=128?(t=t-128,r+="4&"):t>=64?(t=t-64,r+="8&"):t>=32?(t=t-32,r+="16&"):t>=16?(t=t-16,r+="32&"):(r=r.slice(0,r.length-1),r+=`%${Math.floor(t/2)}&`,t=0);return r.slice(0,r.length-1)}function Re(e){const t=[];let r=-1,a=0;return e.forEach(i=>{r!=i.ticks?(r=i.ticks,a=0):a+=1,t[a]==null&&t.push([]),t[a].push(i)}),t}function Ke(e){return e.toLowerCase().slice(0,e.length-1).replace("#","+")}function Xe(e){return Object.values(e).flat(4)}function Qe(e,t="asc"){const r={};for(const[a,i]of Object.entries(e)){const o=i.sort(t=="desc"?Ze:Ye);r[a.toString()]=o}return r}function ee(e){const t={};let r=0;return e.forEach(a=>{r=a.ticks,t[r.toString()]==null&&(t[r.toString()]=[]),t[r.toString()].push(a)}),t}function Ye(e,t){return e.midi-t.midi}function Ze(e,t){return t.midi-e.midi}const et=document.querySelector("#inputMidi"),tt=document.querySelector("#btnConvert"),rt=document.querySelector("#tracks");window.onload=()=>{tt.addEventListener("click",nt)};function nt(){const e=et.files[0],t=URL.createObjectURL(e),r=rt.querySelector("tbody");r.textContent="",R.Midi.fromUrl(t).then(a=>{for(const i of a.tracks){const o=r.insertRow(),[n,f,u]=[o.insertCell(),o.insertCell(),o.insertCell()];if(n.appendChild(document.createTextNode(i.channel.toString())),f.appendChild(document.createTextNode(i.name)),i.channel==9){const c=We(i),b=document.createElement("div");b.textContent=c,u.appendChild(b)}else Ge(i).forEach(b=>{const p=document.createElement("div");p.textContent=b,u.appendChild(p)})}})}
